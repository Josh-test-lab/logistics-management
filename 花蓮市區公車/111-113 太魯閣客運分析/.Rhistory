tpass[1, ]
nrow(tpass)
color <- gray.colors(length(year.from:year.to) + 1)
color
color[1]
color[1:2]
year.from:year.to - 1911
paste0(year.from:year.to - 1911, '年')
# 多年個別TPASS運量
year_tpass_plot <- function(bus, year.from, year.to, month.from, month.to) {
color <- gray.colors(length(year.from:year.to) + 1)
tpass = data.frame()
for(year_index in year.from:year.to){
months = generate_months(year_index, year_index, month.from, month.to)
year_data = NULL
for(month_index in months){
year_data = c(year_data, sum(df_summary[[month_index]][[bus]][['SubTicketType']][[2]])
- as.data.frame(df_summary[[month_index]][[bus]]$SubTicketType)[[2]][is.na(df_summary[[month_index]][[bus]]$SubTicketType$SubTicketType)]
)
}
tpass = rbind(tpass, year_data)
}
colnames(tpass) = month.from:month.to
rownames(tpass) = year.from:year.to
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = tpass[1, ],
type = "o",
lwd = 2,
pch = 16,
col = color[0],
xlab = "月份",
ylab = "搭乘次數",
ylim = c(min(tpass) * 0.9, max(tpass) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
title(main = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖'), cex.main = 2, adj = 0)
for(index in 2:nrow(tpass)){
lines(x = month.from:month.to,
y = tpass[index, ],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[index]
)
}
# x 軸
axis(side = 1, at = x_dates, labels = months, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
grid()  # 網格線
# 圖例
legend("topright",
legend = paste0(year.from:year.to - 1911, '年'),
col = color[1:nrow(tpass)],
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
generate_year_tpass_plot <- function(buses, year.from, year.to, month.from, month.to){
for (bus in buses){
# 繪圖 (在 R中呈現)
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
# 儲存圖片
path = paste0("images/from_", year.from - 1911, "_to_", year.to - 1911, "/", bus, "/line chart")
check_path(path)
img_filename = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖')
png(filename = paste0(path, "/", img_filename, ".png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
dev.off()
}
}
# 畫到至今為止的圖
year.from = 2023
year.to = 2024
generate_year_tpass_plot(buses, year.from, year.to, 1, 12)  # 全年
# 多年個別TPASS運量
year_tpass_plot <- function(bus, year.from, year.to, month.from, month.to) {
color <- gray.colors(length(year.from:year.to) + 1)
tpass = data.frame()
for(year_index in year.from:year.to){
months = generate_months(year_index, year_index, month.from, month.to)
year_data = NULL
for(month_index in months){
year_data = c(year_data, sum(df_summary[[month_index]][[bus]][['SubTicketType']][[2]])
- as.data.frame(df_summary[[month_index]][[bus]]$SubTicketType)[[2]][is.na(df_summary[[month_index]][[bus]]$SubTicketType$SubTicketType)]
)
}
tpass = rbind(tpass, year_data)
}
colnames(tpass) = month.from:month.to
rownames(tpass) = year.from:year.to
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = tpass[1, ],
type = "o",
lwd = 2,
pch = 16,
col = color[0],
xlab = "月份",
ylab = "搭乘次數",
ylim = c(min(tpass) * 0.9, max(tpass) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
title(main = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖'), cex.main = 2, adj = 0)
for(index in 2:nrow(tpass)){
lines(x = month.from:month.to,
y = tpass[index, ],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[index]
)
}
# x 軸
axis(side = 1, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
grid()  # 網格線
# 圖例
legend("topright",
legend = paste0(year.from:year.to - 1911, '年'),
col = color[1:nrow(tpass)],
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
generate_year_tpass_plot <- function(buses, year.from, year.to, month.from, month.to){
for (bus in buses){
# 繪圖 (在 R中呈現)
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
# 儲存圖片
path = paste0("images/from_", year.from - 1911, "_to_", year.to - 1911, "/", bus, "/line chart")
check_path(path)
img_filename = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖')
png(filename = paste0(path, "/", img_filename, ".png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
dev.off()
}
}
# 畫到至今為止的圖
year.from = 2023
year.to = 2024
generate_year_tpass_plot(buses, year.from, year.to, 1, 12)  # 全年
generate_year_tpass_plot(buses, year.from, year.to, 1, 6)   # 上半年
generate_year_tpass_plot(buses, year.from, year.to, 7, 12)  # 下半年
# 多年個別TPASS運量
year_tpass_plot <- function(bus, year.from, year.to, month.from, month.to) {
color <- gray.colors(length(year.from:year.to) + 1)
tpass = data.frame()
for(year_index in year.from:year.to){
months = generate_months(year_index, year_index, month.from, month.to)
year_data = NULL
for(month_index in months){
year_data = c(year_data, sum(df_summary[[month_index]][[bus]][['SubTicketType']][[2]])
- as.data.frame(df_summary[[month_index]][[bus]]$SubTicketType)[[2]][is.na(df_summary[[month_index]][[bus]]$SubTicketType$SubTicketType)]
)
}
tpass = rbind(tpass, year_data)
}
colnames(tpass) = month.from:month.to
rownames(tpass) = year.from:year.to
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = tpass[1, ],
type = "o",
lwd = 2,
pch = 16,
col = color[0],
xlab = "月份",
ylab = "搭乘次數",
ylim = c(min(tpass) * 0.9, max(tpass) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
title(main = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖'), cex.main = 2, adj = 0)
for(index in 2:nrow(tpass)){
lines(x = month.from:month.to,
y = tpass[index, ],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[index]
)
}
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
grid()  # 網格線
# 圖例
legend("topright",
legend = paste0(year.from:year.to - 1911, '年'),
col = color[1:nrow(tpass)],
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
generate_year_tpass_plot <- function(buses, year.from, year.to, month.from, month.to){
for (bus in buses){
# 繪圖 (在 R中呈現)
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
# 儲存圖片
path = paste0("images/from_", year.from - 1911, "_to_", year.to - 1911, "/", bus, "/line chart")
check_path(path)
img_filename = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖')
png(filename = paste0(path, "/", img_filename, ".png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
dev.off()
}
}
# 畫到至今為止的圖
year.from = 2023
year.to = 2024
generate_year_tpass_plot(buses, year.from, year.to, 1, 12)  # 全年
generate_year_tpass_plot(buses, year.from, year.to, 1, 6)   # 上半年
generate_year_tpass_plot(buses, year.from, year.to, 7, 12)  # 下半年
tpass
year.from
month.from
color <- gray.colors(length(year.from:year.to) + 1)
tpass = data.frame()
for(year_index in year.from:year.to){
months = generate_months(year_index, year_index, month.from, month.to)
year_data = NULL
for(month_index in months){
year_data = c(year_data, sum(df_summary[[month_index]][[bus]][['SubTicketType']][[2]])
- as.data.frame(df_summary[[month_index]][[bus]]$SubTicketType)[[2]][is.na(df_summary[[month_index]][[bus]]$SubTicketType$SubTicketType)]
)
}
tpass = rbind(tpass, year_data)
}
colnames(tpass) = month.from:month.to
rownames(tpass) = year.from:year.to
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = tpass[1, ],
type = "o",
lwd = 2,
pch = 16,
col = color[0],
xlab = "月份",
ylab = "搭乘次數",
ylim = c(min(tpass) * 0.9, max(tpass) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
title(main = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖'), cex.main = 2, adj = 0)
# 多年個別TPASS運量
year_tpass_plot <- function(bus, year.from, year.to, month.from, month.to) {
color <- gray.colors(length(year.from:year.to) + 1)
tpass = data.frame()
for(year_index in year.from:year.to){
months = generate_months(year_index, year_index, month.from, month.to)
year_data = NULL
for(month_index in months){
year_data = c(year_data, sum(df_summary[[month_index]][[bus]][['SubTicketType']][[2]])
- as.data.frame(df_summary[[month_index]][[bus]]$SubTicketType)[[2]][is.na(df_summary[[month_index]][[bus]]$SubTicketType$SubTicketType)]
)
}
tpass = rbind(tpass, year_data)
}
colnames(tpass) = month.from:month.to
rownames(tpass) = year.from:year.to
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = tpass[1, ],
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "搭乘次數",
ylim = c(min(tpass) * 0.9, max(tpass) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
title(main = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖'), cex.main = 2, adj = 0)
for(index in 2:nrow(tpass)){
lines(x = month.from:month.to,
y = tpass[index, ],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[index]
)
}
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
grid()  # 網格線
# 圖例
legend("topright",
legend = paste0(year.from:year.to - 1911, '年'),
col = color[1:nrow(tpass)],
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
generate_year_tpass_plot <- function(buses, year.from, year.to, month.from, month.to){
for (bus in buses){
# 繪圖 (在 R中呈現)
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
# 儲存圖片
path = paste0("images/from_", year.from - 1911, "_to_", year.to - 1911, "/", bus, "/line chart")
check_path(path)
img_filename = paste0(year.from - 1911, '年至', year.to - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖')
png(filename = paste0(path, "/", img_filename, ".png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
year_tpass_plot(bus, year.from, year.to, month.from, month.to)
dev.off()
}
}
# 畫到至今為止的圖
year.from = 2023
year.to = 2024
generate_year_tpass_plot(buses, year.from, year.to, 1, 12)  # 全年
generate_year_tpass_plot(buses, year.from, year.to, 1, 6)   # 上半年
generate_year_tpass_plot(buses, year.from, year.to, 7, 12)  # 下半年
bus
year_index
month.from
month.to
months = generate_months(year_index, year_index, month.from, month.to)
transport_volume = NULL
tpass = NULL
color <- gray.colors(3+1)
for (month_index in months){
transport_volume = c(transport_volume, nrow(df[[month_index]][[bus]]))
tpass = c(tpass, sum(df_summary[[month_index]][[bus]][['SubTicketType']][[2]]) - as.data.frame(df_summary[[month_index]][[bus]]$SubTicketType)[[2]][is.na(df_summary[[month_index]][[bus]]$SubTicketType$SubTicketType)]
)
}
transport_volume
month.from
tpass
data.frame(row.names = c('total', 'tpass', 'other', 'tpass%', 'other%'), transport_volume, tpass, other_volume, tpass / transport_volume, other_volume / transport_volume)
other_volume = transport_volume - tpass
data.frame(row.names = c('total', 'tpass', 'other', 'tpass%', 'other%'), transport_volume, tpass, other_volume, tpass / transport_volume, other_volume / transport_volume)
data.frame('total' = transport_volume, 'tpass' = tpass, 'other' = other_volume, 'tpass%' = tpass / transport_volume, 'other%' = other_volume / transport_volume)
tpass_table = data.frame('total' = transport_volume, 'tpass' = tpass, 'other' = other_volume, 'tpass%' = tpass / transport_volume, 'other%' = other_volume / transport_volume)
tpass_table
tpass_table = data.frame('total' = transport_volume, 'tpass' = tpass, 'other' = other_volume, 'tpass%' = tpass / transport_volume, 'other%' = other_volume / transport_volume).T
tpass_table
tpass_table = data.frame('total' = transport_volume, 'tpass' = tpass, 'other' = other_volume, 'tpass%' = tpass / transport_volume, 'other%' = other_volume / transport_volume).T
tpass_table
tpass_table.T
t(tpass_table)
other_volume = transport_volume - tpass
tpass_table = data.frame('total' = transport_volume, 'tpass' = tpass, 'other' = other_volume, 'tpass%' = tpass / transport_volume, 'other%' = other_volume / transport_volume) %>% t()
colnames(tpass_table) = months
tpass_table
data.frame(
total   = transport_volume,
tpass   = tpass,
other   = other_volume,
tpass.  = tpass / transport_volume,
other.  = other_volume / transport_volume
)
other_volume = transport_volume - tpass
tpass_table = data.frame('total' = transport_volume,
'tpass' = tpass,
'other' = other_volume,
'tpass%' = round(tpass / transport_volume * 100, 2),
'other%' = round(other_volume / transport_volume * 100, 2)
) %>% t()
colnames(tpass_table) = months
tpass_table
# TPASS 運量
tpass_volume_plot <- function(bus, year_index, month.from, month.to) {
months = generate_months(year_index, year_index, month.from, month.to)
transport_volume = NULL
tpass = NULL
color <- gray.colors(3+1)
for (month_index in months){
transport_volume = c(transport_volume, nrow(df[[month_index]][[bus]]))
tpass = c(tpass, sum(df_summary[[month_index]][[bus]][['SubTicketType']][[2]]) - as.data.frame(df_summary[[month_index]][[bus]]$SubTicketType)[[2]][is.na(df_summary[[month_index]][[bus]]$SubTicketType$SubTicketType)]
)
}
other_volume = transport_volume - tpass
tpass_table = data.frame('total' = transport_volume,
'tpass' = tpass,
'other' = other_volume,
'tpass_percentage' = round(tpass / transport_volume * 100, 2),
'other_percentage' = round(other_volume / transport_volume * 100, 2)
) %>% t()
colnames(tpass_table) = months
print(tpass_table)
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = transport_volume,
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "搭乘次數",
ylim = c(min(tpass) * 0.9, max(transport_volume) * 1.2),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
title(main = paste0(year_index - 1911, '年', month.from, '月至', month.to, '月路線', bus, '搭乘次數折線圖'), cex.main = 2, adj = 0)
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
lines(x = month.from:month.to,
y = tpass,
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[2]
)
lines(x = month.from:month.to,
y = transport_volume - tpass,
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[3]
)
text(x = month.from:month.to,
y = transport_volume + max(transport_volume) * 0.02,
labels = transport_volume,
pos = 3,            # 文字顯示在點上方
cex = 1.5,          # 文字大小
col = "black"
)
grid()  # 網格線
# 圖例
legend("topright",
legend = c("總運量", "TPASS旅客", "其他旅客"),
col = color,
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.17, 0),
xpd = TRUE,
cex = 1.5
)
}
generate_tpass_volume_plot <- function(buses, year.from, year.to, month.from, month.to) {
for (year_index in year.from:year.to){
for (bus in buses){
# 繪圖 (在 R中呈現)
tpass_volume_plot(bus, year_index, month.from, month.to)
# 儲存圖片
path = paste0("images/", year_index - 1911, "/", bus, "/line chart")
check_path(path)
img_filename = paste0(year_index - 1911, '年', month.from, '月至', month.to, '月路線', bus, 'TPASS搭乘次數折線圖')
png(filename = paste0(path, "/", img_filename, ".png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
tpass_volume_plot(bus, year_index, month.from, month.to)
dev.off()
}
}
}
# 繪圖
generate_tpass_volume_plot(buses, year.from, year.to, 1, 12)  # 全年
generate_tpass_volume_plot(buses, year.from, year.to, 1, 6)   # 上半年
generate_tpass_volume_plot(buses, year.from, year.to, 7, 12)  # 下半年
