png(filename = paste0(path, "/tpass_volume.png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
tpass_volume_plot(bus, year)
dev.off()
}
}
# TPASS 日均運量
tpass_volume_plot <- function(bus, year) {
months = generate_months(year, year, month.from, month.to)
transport_volume = NULL
tpass = NULL
month.days = NULL
color <- gray.colors(3+1)
for (month_index in months){
transport_volume = c(transport_volume, nrow(df[[month_index]][[bus]]))
tpass = c(tpass, df_summary[[month_index]][[bus]][['SubTicketType']][[2]][1] + df_summary[[month_index]][[bus]][['SubTicketType']][[2]][2])
}
for (month_index in month.from:month.to){
week.days = monthly_weekday_and_weekend(year = year, month = month_index)[['Freq']]
month.days = c(month.days, sum(week.days))
}
month.volume.per_day = transport_volume / month.days
tpass[is.na(tpass)] = 0
tpass.volume.per_day = tpass / month.days
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = month.volume.per_day,
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "日均人次",
main = paste0(year - 1911, '年', month.from, '月至', month.to, '月', bus, '路線日均乘車人次折線圖'),
ylim = c(min(tpass.volume.per_day) * 0.9, max(month.volume.per_day) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
lines(x = month.from:month.to,
y = tpass.volume.per_day,
type = "o",
lwd = 2,
pch = 16,
col = color[2]
)
lines(x = month.from:month.to,
y = month.volume.per_day - tpass.volume.per_day,
type = "o",
lwd = 2,
pch = 16,
col = color[3]
)
grid()  # 網格線
# 圖例
legend("topright",
legend = c("月日均", "TPASS旅客", "其他旅客"),
col = color,
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.17, 0),
xpd = TRUE,
cex= 1.5
)
}
# 車輛
#bus = '301'
for (year in year.from:year.to){
for (bus in buses){
# 繪圖 (在 R中呈現)
tpass_volume_plot(bus, year)
# 儲存圖片
path = paste0("images/", year - 1911, "/", bus, "/line_chart")
check_path(path)
png(filename = paste0(path, "/tpass_average_volume.png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
tpass_volume_plot(bus, year)
dev.off()
}
}
# 平假日乘車人次
weekend_and_weekday_volume_plot <- function(bus, year) {
months = generate_months(year, year, month.from, month.to)
weekend.days = NULL
weekday.days = NULL
month.days = NULL
weekend.volume = NULL
weekday.volume = NULL
month.volume = NULL
color <- gray.colors(3+1)
for (month_index in month.from:month.to){
week.days = monthly_weekday_and_weekend(year = year, month = month_index)[['Freq']]
weekday.days = c(weekday.days, week.days[1])
weekend.days = c(weekend.days, week.days[2])
month.days = c(month.days, sum(week.days))
week.volume = df_summary[[sprintf("%04d%02d", year, month_index)]][[bus]][['Weekday']]
weekday.volume = c(weekday.volume, sum(week.volume$n[week.volume$Weekday %in% c("星期一", "星期二", "星期三", "星期四", "星期五")]))
weekend.volume = c(weekend.volume, sum(week.volume$n[week.volume$Weekday %in% c("星期六", "星期日")]))
month.volume = c(month.volume, sum(week.volume$n))
}
weekday.volume.per_day = weekday.volume / weekday.days
weekend.volume.per_day = weekend.volume / weekend.days
month.volume.per_day = month.volume / month.days
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = month.volume.per_day,
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "日均人次",
main = paste0(year - 1911, '年', month.from, '月至', month.to, '月', bus, '路線日均乘車人次折線圖'),
ylim = c(min(weekday.volume.per_day, weekend.volume.per_day, month.volume.per_day) * 0.9,
max(weekday.volume.per_day, weekend.volume.per_day, month.volume.per_day) * 1.1
),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
lines(x = month.from:month.to,
y = weekday.volume.per_day,
type = "o",
lwd = 2,
pch = 16,
col = color[2]
)
lines(x = month.from:month.to,
y = weekend.volume.per_day,
type = "o",
lwd = 2,
pch = 16,
col = color[3]
)
grid()  # 網格線
# 圖例
legend("topright",
legend = c("月日均", "平日日均", "假日日均"),
col = color,
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.16, 0),
xpd = TRUE,
cex = 1.5
)
}
# 車輛
#bus = '301'
for (year in year.from:year.to){
for (bus in buses){
# 繪圖 (在 R中呈現)
weekend_and_weekday_volume_plot(bus, year)
# 儲存圖片
path = paste0("images/", year - 1911, "/", bus, "/line_chart")
check_path(path)
png(filename = paste0(path, "/weekend_and_weekday_average_volume.png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
weekend_and_weekday_volume_plot(bus, year)
dev.off()
}
}
# # 平假日乘車人次 (ggplot2)
# bus = '301'
# weekend.days = NULL
# weekday.days = NULL
# month.days = NULL
# weekend.volume = NULL
# weekday.volume = NULL
# month.volume = NULL
#
# for (month_index in month.from:month.to){
#   week.days = monthly_weekday_and_weekend(year = year, month = month_index)[['Freq']]
#   weekday.days = c(weekday.days, week.days[1])
#   weekend.days = c(weekend.days, week.days[2])
#   month.days = c(month.days, sum(week.days))
#
#   week.volume = df_summary[[sprintf("%04d%02d", year, month_index)]][[bus]][['Weekday']]
#   weekday.volume = c(weekday.volume, sum(week.volume$n[week.volume$Weekday %in% c("星期一", "星期二", "星期三", "星期四", "星期五")]))
#   weekend.volume = c(weekend.volume, sum(week.volume$n[week.volume$Weekday %in% c("星期六", "星期日")]))
#   month.volume = c(month.volume, sum(week.volume$n))
# }
#
# weekday.volume.per_day = weekday.volume / weekday.days
# weekend.volume.per_day = weekend.volume / weekend.days
# month.volume.per_day = month.volume / month.days
#
# plot_df <- data.frame(
#   月份 = month.from:month.to,
#   月日均 = month.volume.per_day,
#   平日 = weekday.volume.per_day,
#   假日 = weekend.volume.per_day
# ) %>% pivot_longer(cols = -月份, names_to = "類別", values_to = "人次")
#
# p <- ggplot(plot_df, aes(x = 月份, y = 人次, color = 類別)) +
#   geom_line(size = 1.2) +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("月日均" = "gray", "平日" = "red", "假日" = "darkgreen")) +
#   labs(
#     x = "月份",
#     y = "日均人次",
#     title = paste0(year - 1911, '年', month.from, '月至', month.to, '月', bus, '路線日均乘車人次折線圖'),
#     color = NULL
#   ) +
#   scale_x_continuous(
#     breaks = plot_df$月份
#   ) +
#   scale_y_continuous(
#     breaks = pretty(c(min(plot_df$人次), max(plot_df$人次))),
#     limits = c(min(plot_df$人次), max(plot_df$人次)),
#     expand = expansion(mult = c(0.05, 0.05))
#   ) +
#   theme_minimal(base_family = "kai") +
#   theme(
#     text = element_text(size = 14),
#     plot.title = element_text(hjust = 0.5, face = "bold"),
#     legend.position = "right"
#   )
#
# print(p)
#
# # 儲存
# #ggsave("ridership_plot.jpg", plot = p, width = 15, height = 5, dpi = 300)
# 太魯閣客運單一年總運量
total_volume_plot <- function(buses, year) {
months = generate_months(year, year, month.from, month.to)
color <- gray.colors(length(buses)+2)
transport_volume = NULL
for (bus in buses){
transport_each_volume = NULL
for (month_index in months){
transport_each_volume = c(transport_each_volume, nrow(df[[month_index]][[bus]]))
}
transport_volume = c(transport_volume, list(transport_each_volume))
}
transport_volume = append(list(Reduce("+", transport_volume)), transport_volume)  # total
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = transport_volume[[1]],
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "乘車人次",
main = paste0(year - 1911, '年', month.from, '月至', month.to, '月太魯閣客運總運量'),
ylim = c(min(sapply(transport_volume, min)) * 0.9 , max(sapply(transport_volume, max)) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
for(bus_index in 2:(length(buses)+1)){
lines(x = month.from:month.to,
y = transport_volume[[bus_index]],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[bus_index]
)
}
grid()  # 網格線
# 圖例
legend("topright",
legend = c('總人次', paste0(buses, '路線')),
col = color,
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
for (year in year.from:year.to){
# 繪圖 (在 R中呈現)
total_volume_plot(buses, year)
# 儲存圖片
path = paste0("images/", year - 1911, "/total/line_chart")
check_path(path)
png(filename = paste0(path, "/total_volume.png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
total_volume_plot(buses, year)
dev.off()
}
# 太魯閣客運多年總運量
total_volume_plot <- function(buses, year.from, year.to) {
years = year.from:year.to
color <- gray.colors(length(years)+1)
for (year in years) {
months = generate_months(year, year, month.from, month.to)
transport_volume = rep(0, length(buses))
for (bus in buses){
transport_each_volume = NULL
for (month_index in months){
transport_each_volume = c(transport_each_volume, nrow(df[[month_index]][[bus]]))
}
transport_volume = transport_volume + transport_each_volume
}
transport_volume_year[[as.character(year)]] = transport_volume  # total
}
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = transport_volume_year[[1]],
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "乘車人次",
main = paste0(year.from - 1911, '年', '至', year.to - 1911, '年太魯閣客運總運量'),
ylim = c(min(sapply(transport_volume_year, min)) * 0.9 , max(sapply(transport_volume_year, max)) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
for(year_index in 2:(length(years))){
lines(x = month.from:month.to,
y = transport_volume_year[[year_index]],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[year_index]
)
}
grid()  # 網格線
# 圖例
legend("topright",
legend = paste0(years, '年'),
col = color,
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
# 繪圖 (在 R中呈現)
total_volume_plot(buses, year.from, year.to)
# 太魯閣客運多年總運量
total_volume_plot <- function(buses, year.from, year.to) {
years = year.from:year.to
color <- gray.colors(length(years)+1)
transport_volume_year = list()
for (year in years) {
months = generate_months(year, year, month.from, month.to)
transport_volume = rep(0, length(buses))
for (bus in buses){
transport_each_volume = NULL
for (month_index in months){
transport_each_volume = c(transport_each_volume, nrow(df[[month_index]][[bus]]))
}
transport_volume = transport_volume + transport_each_volume
}
transport_volume_year[[as.character(year)]] = transport_volume  # total
}
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = transport_volume_year[[1]],
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "乘車人次",
main = paste0(year.from - 1911, '年', '至', year.to - 1911, '年太魯閣客運總運量'),
ylim = c(min(sapply(transport_volume_year, min)) * 0.9 , max(sapply(transport_volume_year, max)) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
for(year_index in 2:(length(years))){
lines(x = month.from:month.to,
y = transport_volume_year[[year_index]],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[year_index]
)
}
grid()  # 網格線
# 圖例
legend("topright",
legend = paste0(years, '年'),
col = color,
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
# 繪圖 (在 R中呈現)
total_volume_plot(buses, year.from, year.to)
# 儲存圖片
path = paste0("images/from_", year.from - 1911, "_to_", year.to - 1911, "/total/line_chart")
check_path(path)
png(filename = paste0(path, "/total_volume.png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
total_volume_plot(buses, year.from, year.to)
dev.off()
# 太魯閣客運多年總運量
total_volume_plot <- function(buses, year.from, year.to) {
years = year.from:year.to
color <- gray.colors(length(years)+1)
transport_volume_year = list()
for (year in years) {
months = generate_months(year, year, month.from, month.to)
transport_volume = rep(0, length(buses))
for (bus in buses){
transport_each_volume = NULL
for (month_index in months){
transport_each_volume = c(transport_each_volume, nrow(df[[month_index]][[bus]]))
}
transport_volume = transport_volume + transport_each_volume
}
transport_volume_year[[as.character(year)]] = transport_volume  # total
}
par(family = "kai", mar = c(5, 6, 4, 10))  # 字體與圖寬
plot(x = month.from:month.to,
y = transport_volume_year[[1]],
type = "o",
lwd = 2,
pch = 16,
col = color[1],
xlab = "月份",
ylab = "乘車人次",
main = paste0(year.from - 1911, '年', '至', year.to - 1911, '年太魯閣客運總運量'),
ylim = c(min(sapply(transport_volume_year, min)) * 0.9 , max(sapply(transport_volume_year, max)) * 1.1),
cex.main = 2,
cex.lab = 2,
cex.axis = 1.5,
cex = 1.5,
xaxt = "n",
yaxt = "n",
bty = "n"
)
# x 軸
axis(side = 1, at = month.from:month.to, labels = month.from:month.to, cex.axis = 1.5)
# y 軸
axis(side = 2, las = 1, cex.axis = 1.5, line = -1.5)
for(year_index in 2:(length(years))){
lines(x = month.from:month.to,
y = transport_volume_year[[year_index]],
type = "o",
lwd = 2,
pch = 16,
cex = 1.5,
col = color[year_index]
)
}
grid()  # 網格線
# 圖例
legend("topright",
legend = paste0(years - 1911, '年'),
col = color,
lwd = 2,
pch = 16,
bty = "n",
inset = c(-0.15, 0),
xpd = TRUE,
cex = 1.5
)
}
# 繪圖 (在 R中呈現)
total_volume_plot(buses, year.from, year.to)
# 儲存圖片
path = paste0("images/from_", year.from - 1911, "_to_", year.to - 1911, "/total/line_chart")
check_path(path)
png(filename = paste0(path, "/total_volume.png"), width = 15, height = 5, units = "in", res = 300, family = "kai")
total_volume_plot(buses, year.from, year.to)
dev.off()
